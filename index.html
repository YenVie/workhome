<!DOCTYPE html>
<html lang="vi">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="mobile-web-app-capable" content="yes">
    <title>ğŸ  Quáº£n LÃ½ Viá»‡c NhÃ </title>
    <link rel="stylesheet" href="styles.css">
    <style>
        .theme-toggle {
            position: absolute;
            top: 1rem;
            right: 1rem;
            width: 40px;
            height: 40px;
            border-radius: 50%;
            border: 1px solid var(--border);
            background: var(--card-bg);
            color: var(--text-primary);
            font-size: 1.25rem;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 250ms ease-in-out;
            box-shadow: var(--shadow-sm);
            z-index: 10;
        }

        .theme-toggle:active {
            transform: scale(0.9);
        }

        .theme-toggle:hover {
            background: var(--card-hover);
            transform: rotate(180deg);
        }

        .week-picker {
            display: flex;
            flex-direction: column;
            gap: 0.5rem;
            margin-top: 0.75rem;
        }

        .week-picker label {
            font-size: 0.875rem;
            font-weight: 600;
            color: var(--text-secondary);
        }

        .week-picker-input {
            padding: 0.75rem;
            background: var(--bg-tertiary);
            border: 1px solid var(--border);
            border-radius: 0.75rem;
            color: var(--text-primary);
            font-size: 1rem;
            font-family: var(--font-family);
            transition: all 150ms ease-in-out;
            cursor: pointer;
        }

        .week-picker-input:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 3px rgba(99, 102, 241, 0.1);
        }

        .week-info {
            color: var(--text-secondary);
            font-size: 0.875rem;
            font-weight: 600;
        }

        .emoji-picker {
            display: flex;
            gap: 0.5rem;
            padding: 0.75rem;
            background: var(--bg-tertiary);
            border-radius: 0.75rem;
            overflow-x: auto;
            overflow-y: hidden;
            -webkit-overflow-scrolling: touch;
        }

        .emoji-btn {
            min-width: 48px;
            min-height: 48px;
            flex-shrink: 0;
            font-size: 1.5rem;
            border: 2px solid transparent;
            border-radius: 0.5rem;
            background: var(--bg-secondary);
            cursor: pointer;
            transition: all 150ms ease-in-out;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .emoji-btn:hover {
            background: var(--card-hover);
            transform: scale(1.1);
        }

        .emoji-btn:active {
            transform: scale(0.95);
        }

        .emoji-btn.selected {
            border-color: var(--primary);
            background: var(--primary);
            box-shadow: 0 0 0 3px rgba(99, 102, 241, 0.2);
        }

        .emoji-picker::-webkit-scrollbar {
            height: 6px;
        }

        .emoji-picker::-webkit-scrollbar-track {
            background: var(--bg-secondary);
            border-radius: 3px;
        }

        .emoji-picker::-webkit-scrollbar-thumb {
            background: var(--border);
            border-radius: 3px;
        }

        .emoji-picker::-webkit-scrollbar-thumb:hover {
            background: var(--primary);
        }
    </style>
</head>

<body>
    <!-- Header -->
    <header class="app-header">
        <button class="theme-toggle" id="themeToggle" title="Chuyá»ƒn giao diá»‡n">ğŸŒ</button>
        <h1>ğŸ  Quáº£n LÃ½ Viá»‡c NhÃ </h1>
    </header>

    <!-- Main Container -->
    <main class="container">
        <!-- Navigation Tabs -->
        <nav class="tabs">
            <button class="tab-btn active" data-tab="overview">ğŸ“… Lá»‹ch Tuáº§n</button>
            <button class="tab-btn" data-tab="tasks">ğŸ“‹ CÃ´ng Viá»‡c</button>
            <button class="tab-btn" data-tab="stats">ğŸ“Š Thá»‘ng KÃª</button>
            <button class="tab-btn" data-tab="settings">âš™ï¸ CÃ i Äáº·t</button>
        </nav>

        <!-- Overview Tab (Weekly Calendar) -->
        <section id="overview-tab" class="tab-content active">
            <div class="calendar-container">
                <div class="calendar-header">
                    <h2>ğŸ“… Lá»‹ch CÃ´ng Viá»‡c Tuáº§n NÃ y</h2>
                    <div class="week-picker">
                        <label for="weekPicker">Chá»n tuáº§n:</label>
                        <input type="date" id="weekPicker" class="week-picker-input" />
                        <div class="week-info" id="weekInfo"></div>
                    </div>
                </div>
                <div class="calendar-grid" id="calendarGrid">
                    <!-- Calendar will be rendered here -->
                </div>
            </div>
        </section>

        <!-- Tasks Tab -->
        <section id="tasks-tab" class="tab-content">
            <div id="tasksList" class="tasks-list">
                <!-- Tasks will be rendered here -->
            </div>
        </section>

        <!-- Stats Tab -->
        <section id="stats-tab" class="tab-content">
            <div class="stats-container">
                <h2>ğŸ“Š Thá»‘ng KÃª ThÃ¡ng NÃ y</h2>
                <div id="memberStats" class="member-stats">
                    <!-- Member statistics will be rendered here -->
                </div>

                <h3>ğŸ“œ Lá»‹ch Sá»­ Gáº§n ÄÃ¢y</h3>
                <div id="historyList" class="history-list">
                    <!-- History will be rendered here -->
                </div>
            </div>
        </section>

        <!-- Settings Tab -->
        <section id="settings-tab" class="tab-content">
            <div class="settings-container">
                <!-- Members Section -->
                <div class="settings-section">
                    <h2>ğŸ‘¥ Quáº£n LÃ½ ThÃ nh ViÃªn</h2>
                    <div id="membersList" class="members-list">
                        <!-- Members will be rendered here -->
                    </div>
                    <button class="btn btn-add" id="addMemberBtn">+ ThÃªm ThÃ nh ViÃªn</button>
                </div>

                <!-- Tasks Section -->
                <div class="settings-section">
                    <h2>ğŸ“‹ Quáº£n LÃ½ CÃ´ng Viá»‡c</h2>
                    <div id="tasksSettingsList" class="tasks-settings-list">
                        <!-- Tasks settings will be rendered here -->
                    </div>
                    <button class="btn btn-add" id="addTaskBtn">+ ThÃªm CÃ´ng Viá»‡c</button>
                </div>

                <!-- Assignment Management Section -->
                <div class="settings-section">
                    <h2>ğŸ“Œ Quáº£n LÃ½ PhÃ¢n CÃ´ng</h2>
                    <div id="assignmentsList" class="assignments-list">
                        <!-- Assignments will be rendered here -->
                    </div>
                </div>

                <!-- Data Management -->
                <div class="settings-section">
                    <h2>ğŸ’¾ Quáº£n LÃ½ Dá»¯ Liá»‡u</h2>
                    <p class="info-text">ğŸ“… Dá»¯ liá»‡u sáº½ tá»± Ä‘á»™ng reset sau má»—i thÃ¡ng</p>
                    <div class="data-info">
                        <p>ThÃ¡ng hiá»‡n táº¡i: <strong id="currentMonth"></strong></p>
                        <p>Tá»•ng sá»‘ láº§n hoÃ n thÃ nh: <strong id="totalCompletions"></strong></p>
                    </div>
                    <div class="btn-group">
                        <button class="btn btn-primary" id="syncBtn" onclick="syncWithFirebase()">ğŸ”„ Sync vá»›i
                            Firebase</button>
                        <button class="btn btn-secondary" id="exportBtn">ğŸ“¤ Export Dá»¯ Liá»‡u</button>
                        <button class="btn btn-secondary" id="importBtn">ğŸ“¥ Import Dá»¯ Liá»‡u</button>
                        <button class="btn btn-danger" id="resetBtn">ğŸ—‘ï¸ Reset ToÃ n Bá»™</button>
                    </div>
                </div>
            </div>
        </section>
    </main>

    <!-- Modal for Adding/Editing Member -->
    <div id="memberModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 id="memberModalTitle">ThÃªm ThÃ nh ViÃªn</h3>
                <button class="modal-close">&times;</button>
            </div>
            <div class="modal-body">
                <input type="hidden" id="memberIdInput">
                <div class="form-group">
                    <label for="memberNameInput">TÃªn:</label>
                    <input type="text" id="memberNameInput" placeholder="Nháº­p tÃªn..." maxlength="20">
                </div>
                <div class="form-group">
                    <label for="memberEmojiInput">Icon (tÃ¹y chá»n):</label>
                    <input type="hidden" id="memberEmojiInput" value="ğŸ‘¤">
                    <div class="emoji-picker" id="memberEmojiPicker">
                        <button type="button" class="emoji-btn" data-emoji="ğŸ‘¤">ğŸ‘¤</button>
                        <button type="button" class="emoji-btn" data-emoji="ğŸ˜Š">ğŸ˜Š</button>
                        <button type="button" class="emoji-btn" data-emoji="ğŸ˜">ğŸ˜</button>
                        <button type="button" class="emoji-btn" data-emoji="ğŸ¤“">ğŸ¤“</button>
                        <button type="button" class="emoji-btn" data-emoji="ğŸ˜">ğŸ˜</button>
                        <button type="button" class="emoji-btn" data-emoji="ğŸ¥³">ğŸ¥³</button>
                        <button type="button" class="emoji-btn" data-emoji="ğŸ˜‡">ğŸ˜‡</button>
                        <button type="button" class="emoji-btn" data-emoji="ğŸŒ¸">ğŸŒ¸</button>
                        <button type="button" class="emoji-btn" data-emoji="ğŸ’ª">ğŸ’ª</button>
                        <button type="button" class="emoji-btn" data-emoji="ğŸ‘¨">ğŸ‘¨</button>
                        <button type="button" class="emoji-btn" data-emoji="ğŸ‘©">ğŸ‘©</button>
                        <button type="button" class="emoji-btn" data-emoji="ğŸ§‘">ğŸ§‘</button>
                        <button type="button" class="emoji-btn" data-emoji="â­">â­</button>
                        <button type="button" class="emoji-btn" data-emoji="ğŸ’">ğŸ’</button>
                        <button type="button" class="emoji-btn" data-emoji="ğŸ¯">ğŸ¯</button>
                        <button type="button" class="emoji-btn" data-emoji="ğŸ†">ğŸ†</button>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" id="cancelMemberBtn">Há»§y</button>
                <button class="btn btn-primary" id="saveMemberBtn">LÆ°u</button>
            </div>
        </div>
    </div>

    <!-- Modal for Adding/Editing Task -->
    <div id="taskModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 id="taskModalTitle">ThÃªm CÃ´ng Viá»‡c</h3>
                <button class="modal-close">&times;</button>
            </div>
            <div class="modal-body">
                <input type="hidden" id="taskIdInput">
                <div class="form-group">
                    <label for="taskNameInput">TÃªn cÃ´ng viá»‡c:</label>
                    <input type="text" id="taskNameInput" placeholder="VD: Lau nhÃ " maxlength="30">
                </div>
                <div class="form-group">
                    <label for="taskIconInput">Icon:</label>
                    <input type="hidden" id="taskIconInput" value="âœ…">
                    <div class="emoji-picker" id="taskEmojiPicker">
                        <button type="button" class="emoji-btn" data-emoji="ğŸ§¹">ğŸ§¹</button>
                        <button type="button" class="emoji-btn" data-emoji="ğŸ½ï¸">ğŸ½ï¸</button>
                        <button type="button" class="emoji-btn" data-emoji="ğŸ—‘ï¸">ğŸ—‘ï¸</button>
                        <button type="button" class="emoji-btn" data-emoji="ğŸ§º">ğŸ§º</button>
                        <button type="button" class="emoji-btn" data-emoji="ğŸ§¼">ğŸ§¼</button>
                        <button type="button" class="emoji-btn" data-emoji="ğŸš¿">ğŸš¿</button>
                        <button type="button" class="emoji-btn" data-emoji="ğŸ›">ğŸ›</button>
                        <button type="button" class="emoji-btn" data-emoji="ğŸ§½">ğŸ§½</button>
                        <button type="button" class="emoji-btn" data-emoji="ğŸª£">ğŸª£</button>
                        <button type="button" class="emoji-btn" data-emoji="ğŸ’§">ğŸ’§</button>
                        <button type="button" class="emoji-btn" data-emoji="ğŸŒ¿">ğŸŒ¿</button>
                        <button type="button" class="emoji-btn" data-emoji="ğŸ³">ğŸ³</button>
                        <button type="button" class="emoji-btn" data-emoji="â˜•">â˜•</button>
                        <button type="button" class="emoji-btn" data-emoji="ğŸ”ª">ğŸ”ª</button>
                        <button type="button" class="emoji-btn" data-emoji="ğŸ¥˜">ğŸ¥˜</button>
                        <button type="button" class="emoji-btn" data-emoji="âœ…">âœ…</button>
                        <button type="button" class="emoji-btn" data-emoji="âœ”ï¸">âœ”ï¸</button>
                        <button type="button" class="emoji-btn" data-emoji="ğŸ“">ğŸ“</button>
                        <button type="button" class="emoji-btn" data-emoji="ğŸ ">ğŸ </button>
                        <button type="button" class="emoji-btn" data-emoji="ğŸªŸ">ğŸªŸ</button>
                    </div>
                </div>
                <div class="form-group">
                    <label for="taskCycleInput">Chu ká»³:</label>
                    <select id="taskCycleInput">
                        <option value="daily">HÃ ng ngÃ y</option>
                        <option value="every2days">2 ngÃ y/láº§n</option>
                        <option value="weekly">HÃ ng tuáº§n</option>
                    </select>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" id="cancelTaskBtn">Há»§y</button>
                <button class="btn btn-primary" id="saveTaskBtn">LÆ°u</button>
            </div>
        </div>
    </div>

    <!-- Modal for Assigning Task to Member on a Date -->
    <div id="assignmentModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 id="assignmentModalTitle">GÃ¡n CÃ´ng Viá»‡c</h3>
                <button class="modal-close">&times;</button>
            </div>
            <div class="modal-body">
                <input type="hidden" id="assignmentMemberId">
                <input type="hidden" id="assignmentTaskId">
                <input type="hidden" id="assignmentDate">

                <div class="form-group">
                    <label>ThÃ nh viÃªn:</label>
                    <div id="assignmentMemberDisplay" class="assignment-display"></div>
                </div>

                <div class="form-group">
                    <label for="assignmentTaskSelect">CÃ´ng viá»‡c:</label>
                    <select id="assignmentTaskSelect">
                        <option value="">-- Chá»n cÃ´ng viá»‡c --</option>
                    </select>
                </div>

                <div class="form-group">
                    <label for="assignmentDaySelect">NgÃ y:</label>
                    <select id="assignmentDaySelect">
                        <option value="1">Thá»© 2</option>
                        <option value="2">Thá»© 3</option>
                        <option value="3">Thá»© 4</option>
                        <option value="4">Thá»© 5</option>
                        <option value="5">Thá»© 6</option>
                        <option value="6">Thá»© 7</option>
                        <option value="0">Chá»§ Nháº­t</option>
                    </select>
                </div>

                <div class="info-text" style="margin-top: 1rem; font-size: 0.875rem; color: var(--text-secondary);">
                    ğŸ’¡ Má»™t ngÆ°á»i cÃ³ thá»ƒ lÃ m nhiá»u cÃ´ng viá»‡c trong tuáº§n
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" id="cancelAssignmentBtn">Há»§y</button>
                <button class="btn btn-danger" id="clearAssignmentBtn" style="display: none;">XÃ³a PhÃ¢n CÃ´ng</button>
                <button class="btn btn-primary" id="saveAssignmentBtn">LÆ°u</button>
            </div>
        </div>
    </div>

    <!-- Modal for Camera Photo Check-in -->
    <div id="cameraModal" class="modal">
        <div class="modal-content camera-modal-content">
            <div class="modal-header">
                <h3>ğŸ“· Chá»¥p áº¢nh Check-in</h3>
                <button class="modal-close">&times;</button>
            </div>
            <div class="modal-body">
                <input type="hidden" id="cameraTaskId">
                <video id="cameraVideo" autoplay playsinline></video>
                <canvas id="cameraCanvas" style="display:none;"></canvas>
                <img id="capturedImage" style="display:none;" />
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" id="cancelCameraBtn">Há»§y</button>
                <button class="btn btn-primary" id="capturePhotoBtn">ğŸ“· Chá»¥p</button>
                <button class="btn btn-success" id="savePhotoBtn" style="display:none;">âœ“ LÆ°u</button>
                <button class="btn btn-warning" id="retakePhotoBtn" style="display:none;">ğŸ”„ Chá»¥p Láº¡i</button>
            </div>
        </div>
    </div>

    <!-- Hidden file input for import -->
    <input type="file" id="importFileInput" accept=".json" style="display: none;">

    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/9.17.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.17.1/firebase-firestore-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.17.1/firebase-storage-compat.js"></script>

    <!-- Firebase Configuration -->
    <script>
        const firebaseConfig = {
            apiKey: "AIzaSyCE8Re_0-D0QYVuFiguUFe4xI-ldI2Dsbo",
            authDomain: "workhomehcm-f416f.firebaseapp.com",
            projectId: "workhomehcm-f416f",
            storageBucket: "workhomehcm-f416f.firebasestorage.app",
            messagingSenderId: "407929355238",
            appId: "1:407929355238:web:c8089fb6c27dbe2bb1f427"
        };

        // Initialize Firebase
        firebase.initializeApp(firebaseConfig);
        const db = firebase.firestore();
        const storage = firebase.storage();
    </script>

    <script src="app.js"></script>
    <script src="firebase-sync.js"></script>
</body>

</html>